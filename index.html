<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <title>Warta Jemaat Digital</title>
</head>

<body>

    <div id="loader-overlay">
        <div class="spinner"></div>
        <div class="loading-text">Memuat Warta...</div>
    </div>
    <!-- Audio Element (Hidden) -->
    <!-- Pastikan file ini ada di folder yang sama -->
    <audio id="pageFlipSound" src="mixkit-page-turn-single-1104.wav" preload="auto"></audio>

    <div class="viewport">
        <button class="nav-side left" id="prevBtn"><i class="fa-solid fa-chevron-left"></i></button>
        <button class="nav-side right" id="nextBtn"><i class="fa-solid fa-chevron-right"></i></button>
        <div class="book-container">
            <div class="flipbook">
                <!-- Cover Depan -->
                <div class="hard"><img src="images/cover1.svg" alt="" /></div>

                <!-- Cover Dalam Depan (Akan dihapus di Mobile) -->
                <div class="hard inside-cover"><img src="images/Coverin1.svg" alt="" /></div>

                <!-- Halaman Isi -->
                <div><img src="images/page1.svg" alt="" /></div>
                <div><img src="images/page2.svg" alt="" /></div>
                <div><img src="images/page3.svg" alt="" /></div>
                <div><img src="images/page4.svg" alt="" /></div>
                <div><img src="images/page5.svg" alt="" /></div>
                <div><img src="images/page6.svg" alt="" /></div>
                <div><img src="images/page7.svg" alt="" /></div>
                <div><img src="images/page8.svg" alt="" /></div>
                <div><img src="images/page9.svg" alt="" /></div>
                <div><img src="images/page10.svg" alt="" /></div>
                <div><img src="images/page11.svg" alt="" /></div>
                <div><img src="images/page12.svg" alt="" /></div>

                <!-- Cover Dalam Belakang (Akan dihapus di Mobile) -->
                <div class="hard inside-cover"><img src="images/Coverin2.svg" alt="" /></div>

                <!-- Cover Belakang -->
                <div class="hard"><img src="images/cover2.svg" alt="" /></div>

            </div>
        </div>
        <div class="toolbar-container">
            <div id="popupMenu" class="popup-menu">
                <button class="menu-item" id="firstPageBtn"><i class="fa-solid fa-backward-step"></i> Goto First
                    Page</button>
                <button class="menu-item" id="lastPageBtn"><i class="fa-solid fa-forward-step"></i> Goto Last
                    Page</button>
                <button class="menu-item" id="toggleSoundMenu"><i class="fa-solid fa-volume-high"
                        id="soundIconMenu"></i> Turn on/off Sound</button>
            </div>

            <div class="toolbar">
                <div class="page-indicator" id="pageLabel">1 / 14</div>
                <div class="separator"></div>
                <button class="btn" id="zoomOut"><i class="fa-solid fa-minus"></i></button>
                <button class="btn" id="zoomIn"><i class="fa-solid fa-plus"></i></button>
                <div class="separator"></div>
                <button class="btn" id="fullscreenBtn"><i class="fa-solid fa-expand"></i></button>
                <button class="btn" id="menuBtn"><i class="fa-solid fa-ellipsis"></i></button>
            </div>

        </div>
    </div>

    <script src="jquery.js"></script>
    <script src="turn.js"></script>

    <script>
        $(window).on('load', function () {
            var flipbook = $(".flipbook");
            var loader = $("#loader-overlay");
            var audio = document.getElementById("pageFlipSound");

            // Status Suara (Gunakan satu variabel global di dalam load)
            var isSoundOn = true;
            var currentZoomScale = 1;

            // Fungsi suara yang menghargai status isSoundOn
            function playPageSound() {
                if (isSoundOn && audio) {
                    audio.currentTime = 0;
                    audio.play().catch(function (e) { console.log("Audio blocked"); });
                }
            }

            // Inisialisasi Flipbook
            flipbook.turn({
                width: 960,
                height: 680,
                autoCenter: true,
                duration: 1000,
                when: {
                    turning: function () {
                        playPageSound(); // Hanya bunyi jika isSoundOn = true
                    },
                    turned: function (e, page, view) {
                        var totalPages = flipbook.turn("pages");
                        var pageLabel = (view[0] || view[1]) ? view.join("/") : page;
                        $("#pageLabel").text(pageLabel + " / " + totalPages);
                    }
                }
            });

            // Logika ON/OFF Suara (PERBAIKAN)
            $("#toggleSoundMenu").on("click", function (e) {
                e.stopPropagation();
                isSoundOn = !isSoundOn; // Balikkan status

                if (isSoundOn) {
                    $(this).html('<i class="fa-solid fa-volume-high"></i> Turn off Sound');
                    playPageSound(); // Tes bunyi saat diaktifkan
                } else {
                    $(this).html('<i class="fa-solid fa-volume-xmark"></i> Turn on Sound');
                    // Saat OFF, fungsi playPageSound tidak akan melakukan apa-apa
                }
            });

            // Navigasi
            $("#prevBtn").click(function () { flipbook.turn("previous"); });
            $("#nextBtn").click(function () { flipbook.turn("next"); });

            // Zoom Logic
            function applyZoom() {
                var width = $(window).width();
                var baseScale = 1;
                if (width >= 768) {
                    var scaleX = (width - 60) / 960;
                    var scaleY = ($(window).height() - 150) / 680; // Kurangi ruang untuk toolbar
                    baseScale = Math.min(scaleX, scaleY);
                    if (baseScale > 1.2) baseScale = 1.2;
                }
                $(".book-container").css("transform", "scale(" + (baseScale * currentZoomScale) + ")");
            }

            $("#zoomIn").click(function () { currentZoomScale = Math.min(currentZoomScale + 0.1, 2); applyZoom(); });
            $("#zoomOut").click(function () { currentZoomScale = Math.max(currentZoomScale - 0.1, 0.6); applyZoom(); });

            // Menu Popup
            $("#menuBtn").click(function (e) { e.stopPropagation(); $("#popupMenu").toggleClass("show"); });
            $(document).click(function () { $("#popupMenu").removeClass("show"); });

            // Responsive
            $(window).resize(function () {
                var width = $(window).width();
                if (width < 768) {
                    flipbook.turn("display", "single");
                    var mWidth = width - 20;
                    flipbook.turn("size", mWidth, mWidth * 1.414);
                    $(".book-container").css({ "transform": "none", "width": mWidth, "height": mWidth * 1.414 });
                } else {
                    flipbook.turn("display", "double");
                    flipbook.turn("size", 960, 680);
                    applyZoom();
                }
            });
            $(window).trigger('resize');

            setTimeout(function () { loader.fadeOut(500); }, 500);
        });
    </script>
</body>

</html>