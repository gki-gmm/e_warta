<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <title>Warta Jemaat Digital</title>
</head>

<body>

    <div id="loader-overlay">
        <div class="spinner"></div>
        <div class="loading-text">Memuat Warta...</div>
    </div>
    <!-- Audio Element (Hidden) -->
    <!-- Pastikan file ini ada di folder yang sama -->
    <audio id="pageFlipSound" src="mixkit-page-turn-single-1104.wav" preload="auto"></audio>

    <div class="viewport">
        <button class="nav-side left" id="prevBtn"><i class="fa-solid fa-chevron-left"></i></button>
        <button class="nav-side right" id="nextBtn"><i class="fa-solid fa-chevron-right"></i></button>
        <div class="book-container">
            <div class="flipbook">
                <!-- Cover Depan -->
                <div class="hard"><img src="images/cover1.svg" alt="" /></div>

                <!-- Cover Dalam Depan (Akan dihapus di Mobile) -->
                <div class="hard inside-cover"><img src="images/Coverin1.svg" alt="" /></div>

                <!-- Halaman Isi -->
                <div><img src="images/page1.svg" alt="" /></div>
                <div><img src="images/page2.svg" alt="" /></div>
                <div><img src="images/page3.svg" alt="" /></div>
                <div><img src="images/page4.svg" alt="" /></div>
                <div><img src="images/page5.svg" alt="" /></div>
                <div><img src="images/page6.svg" alt="" /></div>
                <div><img src="images/page7.svg" alt="" /></div>
                <div><img src="images/page8.svg" alt="" /></div>
                <div><img src="images/page9.svg" alt="" /></div>
                <div><img src="images/page10.svg" alt="" /></div>
                <div><img src="images/page11.svg" alt="" /></div>
          <!--  <div><img src="images/page12.svg" alt="" /></div>
                <div><img src="images/page13.svg" alt="" /></div>
                <div><img src="images/page14.svg" alt="" /></div>
                <div><img src="images/page15.svg" alt="" /></div> -->
                <div><img src="images/page16.svg" alt="" /></div>
                <div><img src="images/page17.svg" alt="" /></div>
               <!-- <div><img src="images/page18.svg" alt="" /></div>
                <div><img src="images/page19.svg" alt="" /></div> -->

                <!-- Cover Dalam Belakang (Akan dihapus di Mobile) -->
                <div class="hard inside-cover"><img src="images/Coverin2.svg" alt="" /></div>

                <!-- Cover Belakang -->
                <div class="hard"><img src="images/cover2.svg" alt="" /></div>

            </div>
        </div>
        <div class="toolbar-container">
            <div id="popupMenu" class="popup-menu">
                <button class="menu-item" id="firstPageBtn"><i class="fa-solid fa-backward-step"></i> Goto First
                    Page</button>
                <button class="menu-item" id="lastPageBtn"><i class="fa-solid fa-forward-step"></i> Goto Last
                    Page</button>
                <button class="menu-item" id="toggleSoundMenu"><i class="fa-solid fa-volume-high"
                        id="soundIconMenu"></i> Turn on/off Sound</button>
            </div>

            <div class="toolbar">
                <div class="page-indicator" id="pageLabel">1 / 14</div>
                <div class="separator"></div>
                <button class="btn" id="zoomOut"><i class="fa-solid fa-minus"></i></button>
                <button class="btn" id="zoomIn"><i class="fa-solid fa-plus"></i></button>
                <div class="separator"></div>
                <button class="btn" id="fullscreenBtn"><i class="fa-solid fa-expand"></i></button>
                <button class="btn" id="menuBtn"><i class="fa-solid fa-ellipsis"></i></button>
            </div>

        </div>
    </div>

    <script src="jquery.js"></script>
    <script src="turn.js"></script>

    <script>
        $(window).on('load', function () {
            // 1. Inisialisasi Variabel Utama
            var flipbook = $(".flipbook");
            var loader = $("#loader-overlay");
            var audio = document.getElementById("pageFlipSound");
            var isSoundOn = true; // Status suara global
            var currentZoomScale = 1;

            // 2. Fungsi Suara
            function playPageSound() {
                if (isSoundOn && audio) {
                    audio.currentTime = 0;
                    audio.play().catch(function (error) {
                        console.log("Autoplay diblokir browser");
                    });
                }
            }

            // 3. Inisialisasi Turn.js
            flipbook.turn({
                width: 960,
                height: 680,
                autoCenter: true,
                acceleration: true,
                gradients: true,
                elevation: 50,
                duration: 1000,
                when: {
                    turning: function (e, page, view) {
                        playPageSound();
                    },
                    turned: function (e, page, view) {
                        var totalPages = flipbook.turn("pages");
                        var pageLabel = (view[0] || view[1]) ? view.join("/") : page;
                        $("#pageLabel").text(pageLabel + " / " + totalPages);
                    }
                }
            });

            // 4. Logika Tombol Suara (PERBAIKAN DI SINI)
            $("#toggleSoundMenu").on("click", function (e) {
                e.stopPropagation(); // Mencegah menu tertutup

                isSoundOn = !isSoundOn; // Toggle status (true <-> false)

                if (isSoundOn) {
                    // Jika ON
                    $(this).html('<i class="fa-solid fa-volume-high" id="soundIconMenu"></i> Turn off Sound');
                    playPageSound();
                } else {
                    // Jika OFF
                    $(this).html('<i class="fa-solid fa-volume-xmark" id="soundIconMenu"></i> Turn on Sound');
                }
                console.log("Status Suara:", isSoundOn);
            });

            // 5. Navigasi Panah Samping
            $("#prevBtn").on("click", function () { flipbook.turn("previous"); });
            $("#nextBtn").on("click", function () { flipbook.turn("next"); });

            // 6. Logika Zoom
            function applyZoom() {
                var width = $(window).width();
                var baseScale = 1;
                if (width >= 768) {
                    var scaleX = (width - 60) / 960;
                    var scaleY = ($(window).height() - 60) / 680;
                    baseScale = Math.min(scaleX, scaleY);
                    if (baseScale > 1.2) baseScale = 1.2;
                }
                $(".book-container").css("transform", "scale(" + (baseScale * currentZoomScale) + ")");
            }

            $("#zoomIn").click(function () {
                if (currentZoomScale < 2) { currentZoomScale += 0.1; applyZoom(); }
            });
            $("#zoomOut").click(function () {
                if (currentZoomScale > 0.6) { currentZoomScale -= 0.1; applyZoom(); }
            });

            // 7. Menu Popup & Fullscreen
            $("#menuBtn").click(function (e) {
                e.stopPropagation();
                $("#popupMenu").toggleClass("show");
            });
            $(document).click(function () { $("#popupMenu").removeClass("show"); });

            $("#firstPageBtn").click(function () { flipbook.turn("page", 1); });
            $("#lastPageBtn").click(function () { flipbook.turn("page", flipbook.turn("pages")); });

            $("#fullscreenBtn").click(function () {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen();
                } else {
                    if (document.exitFullscreen) { document.exitFullscreen(); }
                }
            });

            // 8. Responsive Logic
            function resizeViewport() {
                var width = $(window).width();
                if (width < 768) {
                    flipbook.turn("display", "single");
                    var mWidth = width - 20;
                    flipbook.turn("size", mWidth, mWidth * 1.414);
                    $(".book-container").css({ "transform": "none", "width": mWidth, "height": mWidth * 1.414 });
                } else {
                    flipbook.turn("display", "double");
                    flipbook.turn("size", 960, 680);
                    applyZoom();
                }
            }

            $(window).resize(resizeViewport);
            resizeViewport();

            // 9. Hilangkan Loader
            setTimeout(function () {
                loader.fadeOut(500, function () { flipbook.addClass("loaded"); });
            }, 500);
        });
    </script>
</body>


</html>
